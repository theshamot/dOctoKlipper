V// source: plugin/preheat/js/preheat.js\u000a$(function() {\u000a	function PreheatViewModel(parameters) {\u000a		var self = this;\u000a		self.settings = undefined;\u000a		self.btnPreheat = undefined;\u000a		self.btnPreheatIcon = undefined;\u000a		self.btnPreheatText = undefined;\u000a		\u000a		self.MODE_PREHEAT = 0;\u000a		self.MODE_COOLDOWN = 1;\u000a		\u000a		self.mode = self.MODE_PREHEAT;\u000a		\u000a		self.loginState = parameters[0];\u000a		self.temperatureState = parameters[1];\u000a		self.printerState = parameters[2];\u000a		self.settings = parameters[3];\u000a		\u000a		self.preheat = function() {\u000a			$.ajax({\u000a				url: API_BASEURL + "plugin/preheat",\u000a				type: "POST",\u000a				dataType: "json",\u000a				data: JSON.stringify({\u000a					command: "preheat"\u000a				}),\u000a				contentType: "application/json; charset=UTF-8",\u000a				error: function (data, status) {\u000a					var options = {\u000a						title: "Preheating failed.",\u000a						text: data.responseText,\u000a						hide: true,\u000a						buttons: {\u000a							sticker: false,\u000a							closer: true\u000a						},\u000a						type: "error"\u000a					};\u000a					\u000a					new PNotify(options);\u000a				}\u000a			});\u000a		};\u000a		\u000a		self.cooldown = function() {\u000a			var targets = {};\u000a			for (tool of Object.keys(self.temperatureState.tools())) {\u000a				targets["tool" + tool] = 0;\u000a			}\u000a			\u000a			$.ajax({\u000a				url: API_BASEURL + "printer/tool",\u000a				type: "POST",\u000a				dataType: "json",\u000a				data: JSON.stringify({\u000a					command: "target",\u000a					targets: targets\u000a				}),\u000a				contentType: "application/json; charset=UTF-8"\u000a			});\u000a			if (self.temperatureState.hasBed()) {\u000a				$.ajax({\u000a					url: API_BASEURL + "printer/bed",\u000a					type: "POST",\u000a					dataType: "json",\u000a					data: JSON.stringify({\u000a						command: "target",\u000a						target: 0\u000a					}),\u000a					contentType: "application/json; charset=UTF-8"\u000a				});\u000a			}\u000a			if (self.temperatureState.hasChamber()) {\u000a				$.ajax({\u000a					url: API_BASEURL + "printer/chamber",\u000a					type: "POST",\u000a					dataType: "json",\u000a					data: JSON.stringify({\u000a						command: "target",\u000a						target: 0\u000a					}),\u000a					contentType: "application/json; charset=UTF-8"\u000a				});\u000a			}\u000a		};\u000a		\u000a		self.btnPreheatClick = function() {\u000a			if (self.mode == self.MODE_PREHEAT) {\u000a				self.preheat();\u000a			}\u000a			if (self.mode == self.MODE_COOLDOWN) {\u000a				self.cooldown();\u000a			}\u000a		}\u000a		\u000a		self.initializeButton = function() {\u000a			var buttonContainer = $('#job_print')[0].parentElement;\u000a			buttonContainer.children[0].style.width = "100%";\u000a			buttonContainer.children[0].style.marginBottom = "10px";\u000a			buttonContainer.children[1].style.marginLeft = "0";\u000a			\u000a			self.btnPreheat = document.createElement("button");\u000a			self.btnPreheat.id = "job_preheat";\u000a			self.btnPreheat.classList.add("btn");\u000a			self.btnPreheat.classList.add("span4");\u000a			self.btnPreheat.addEventListener("click", self.btnPreheatClick);\u000a			\u000a			self.btnPreheatIcon = document.createElement("i");\u000a			self.btnPreheat.appendChild(self.btnPreheatIcon);\u000a			\u000a			self.btnPreheatText = document.createTextNode(" ");\u000a			self.btnPreheat.appendChild(self.btnPreheatText);\u000a			\u000a			self.btnPreheatText.nodeValue = " Preheat";\u000a			self.btnPreheatIcon.classList.add("fa", "fa-fire");\u000a			\u000a			buttonContainer.appendChild(self.btnPreheat);\u000a		};\u000a		\u000a		self.anyTemperatureTarget = function() {\u000a			if (self.temperatureState.hasBed() && self.temperatureState.bedTemp.target() != 0) {\u000a				return true;\u000a			}\u000a			\u000a			for (var i = 0; i < self.temperatureState.tools().length; i++) {\u000a				if (self.temperatureState.tools()[i].target() != 0) {\u000a					return true;\u000a				}\u000a			}\u000a			\u000a			return false;\u000a		}\u000a		\u000a		self.updateButton = function() {\u000a			if (!self.anyTemperatureTarget()) {\u000a				self.mode = self.MODE_PREHEAT;\u000a				self.btnPreheat.title = "Preheats the nozzle for the loaded gcode file.";\u000a				self.btnPreheatText.nodeValue = " Preheat";\u000a				self.btnPreheatIcon.classList.add("fa-fire");\u000a				self.btnPreheatIcon.classList.remove("fa-snowflake-o");\u000a			} else {\u000a				self.mode = self.MODE_COOLDOWN;\u000a				self.btnPreheat.title = "Disables tool heating.";			\u000a				self.btnPreheatText.nodeValue = " Cool";\u000a				self.btnPreheatIcon.classList.add("fa-snowflake-o");\u000a				self.btnPreheatIcon.classList.remove("fa-fire");\u000a			}\u000a			\u000a			var target = 0;\u000a			if (self.temperatureState.tools().length > 0) {\u000a				target = self.temperatureState.tools()[0].target();\u000a			}\u000a			\u000a			self.btnPreheat.disabled = !self.temperatureState.isReady()\u000a				|| self.temperatureState.isPrinting()\u000a				|| !self.loginState.isUser()\u000a				|| (target == 0 && self.printerState.filename() == null && !self.settings.settings.plugins.preheat.use_fallback_when_no_file_selected());\u000a		};\u000a\u000a		self.onDataUpdaterPluginMessage = function(plugin, data) {\u000a			if (plugin == "preheat" && data.type == "preheat_complete") {\u000a				new PNotify({\u000a					title: 'Preheat complete',\u000a					text: 'Printing temperatures reached.',\u000a					type: 'success'\u000a				});\u000a			}\u000a			if (plugin == "preheat" && data.type == "preheat_warning") {\u000a				new PNotify({\u000a					title: 'Preheating cancelled',\u000a					text: data.message,\u000a					type: 'warning'\u000a				});\u000a			}\u000a		}\u000a		\u000a		self.initializeButton();\u000a		self.fromCurrentData = function() { self.updateButton(); };\u000a		self.updateButton();\u000a	}\u000a	\u000a	OCTOPRINT_VIEWMODELS.push([\u000a		PreheatViewModel,\u000a		["loginStateViewModel", "temperatureViewModel", "printerStateViewModel", "settingsViewModel"],\u000a		[]\u000a	]);\u000a});\u000a;\u000a
p0
.