V// source: plugin/UltimakerFormatPackage/js/UltimakerFormatPackage.js\u000a/*\u000a * View model for OctoPrint-UltimakerFormatPackage\u000a *\u000a * Author: jneilliii\u000a * License: AGPLv3\u000a */\u000a$(function() {\u000a	function UltimakerformatpackageViewModel(parameters) {\u000a		var self = this;\u000a		self.thumbnail_url = ko.observable('/static/img/tentacle-20x20.png');\u000a		self.thumbnail_title = ko.observable('');\u000a		self.inline_thumbnail = ko.observable();\u000a		self.crawling_files = ko.observable(false);\u000a		self.crawl_results = ko.observableArray([]);\u000a\u000a		self.settingsViewModel = parameters[0];\u000a		self.filesViewModel = parameters[1];\u000a\u000a		self.filesViewModel.UltimakerFormatPackage_open_thumbnail = function(data) {\u000a			if(data.name.indexOf('.gcode') > 0){\u000a				var thumbnail_title = data.path.replace('.gcode','');\u000a				var thumbnail_url = ((data.thumbnail) ? data.thumbnail : 'plugin/UltimakerFormatPackage/thumbnail/' + data.path.replace('.ufp.gcode','.png'));\u000a				self.thumbnail_url(thumbnail_url);\u000a				self.thumbnail_title(thumbnail_title);\u000a				$('div#UltimakerFormatPackage_thumbnail_viewer').modal("show");\u000a			}\u000a		}\u000a\u000a		self.DEFAULT_THUMBNAIL_SCALE = "100%"\u000a		self.filesViewModel.thumbnailScaleValue = ko.observable(self.DEFAULT_THUMBNAIL_SCALE)\u000a\u000a		self.DEFAULT_THUMBNAIL_ALIGN = "left"\u000a		self.filesViewModel.thumbnailAlignValue = ko.observable(self.DEFAULT_THUMBNAIL_ALIGN)\u000a\u000a		self.crawl_files = function(){\u000a			self.crawling_files(true);\u000a			self.crawl_results([]);\u000a			$.ajax({\u000a				url: API_BASEURL + "plugin/UltimakerFormatPackage",\u000a				type: "POST",\u000a				dataType: "json",\u000a				data: JSON.stringify({\u000a					command: "crawl_files"\u000a				}),\u000a				contentType: "application/json; charset=UTF-8"\u000a			}).done(function(data){\u000a				for (key in data) {\u000a					if(data[key].length){\u000a						self.crawl_results.push({name: ko.observable(key), files: ko.observableArray(data[key])});\u000a					}\u000a				}\u000a				\u000a				console.log(data);\u000a				if(self.crawl_results().length == 0){\u000a					self.crawl_results.push({name: ko.observable('No convertible files found'), files: ko.observableArray([])});\u000a				}\u000a				self.filesViewModel.requestData({force: true});\u000a				self.crawling_files(false);\u000a			}).fail(function(data){\u000a				self.crawling_files(false);\u000a			})\u000a		}\u000a\u000a		self.onBeforeBinding = function() {\u000a			// assign initial scaling\u000a			if (self.settingsViewModel.settings.plugins.UltimakerFormatPackage.scale_inline_thumbnail()==true){\u000a				self.filesViewModel.thumbnailScaleValue(self.settingsViewModel.settings.plugins.UltimakerFormatPackage.inline_thumbnail_scale_value() + "%");\u000a			}\u000a\u000a			// assign initial alignment\u000a			if (self.settingsViewModel.settings.plugins.UltimakerFormatPackage.align_inline_thumbnail()==true){\u000a				self.filesViewModel.thumbnailAlignValue(self.settingsViewModel.settings.plugins.UltimakerFormatPackage.inline_thumbnail_align_value());\u000a			}\u000a\u000a			// observe scaling changes\u000a			self.settingsViewModel.settings.plugins.UltimakerFormatPackage.scale_inline_thumbnail.subscribe(function(newValue){\u000a				if (newValue == false){\u000a					self.filesViewModel.thumbnailScaleValue(self.DEFAULT_THUMBNAIL_SCALE);\u000a				} else {\u000a					self.filesViewModel.thumbnailScaleValue(self.settingsViewModel.settings.plugins.UltimakerFormatPackage.inline_thumbnail_scale_value() + "%");\u000a				}\u000a			});\u000a			self.settingsViewModel.settings.plugins.UltimakerFormatPackage.inline_thumbnail_scale_value.subscribe(function(newValue){\u000a				self.filesViewModel.thumbnailScaleValue(newValue + "%");\u000a			});\u000a\u000a			// observe alignment changes\u000a			self.settingsViewModel.settings.plugins.UltimakerFormatPackage.align_inline_thumbnail.subscribe(function(newValue){\u000a				if (newValue == false){\u000a					self.filesViewModel.thumbnailAlignValue(self.DEFAULT_THUMBNAIL_SCALE);\u000a				} else {\u000a					self.filesViewModel.thumbnailAlignValue(self.settingsViewModel.settings.plugins.UltimakerFormatPackage.inline_thumbnail_align_value());\u000a				}\u000a			});\u000a			self.settingsViewModel.settings.plugins.UltimakerFormatPackage.inline_thumbnail_align_value.subscribe(function(newValue){\u000a				self.filesViewModel.thumbnailAlignValue(newValue);\u000a			});\u000a\u000a			self.filesViewModel.listHelper.selectedItem.subscribe(function(data){\u000a				// remove the state panel thumbnail in case it's already there\u000a				if(data){\u000a					console.log(self.settingsViewModel.settings.plugins.UltimakerFormatPackage.state_panel_thumbnail() && (data.thumbnail || data.name.indexOf('.ufp.gcode') > 0) && (data.thumbnail_src == 'UltimakerFormatPackage' || data.name.indexOf('.ufp.gcode') > 0));\u000a					if(self.settingsViewModel.settings.plugins.UltimakerFormatPackage.state_panel_thumbnail() && (data.thumbnail || data.name.indexOf('.ufp.gcode') > 0) && (data.thumbnail_src == 'UltimakerFormatPackage' || data.name.indexOf('.ufp.gcode') > 0)){\u000a						if($('#UFP_state_thumbnail').length){\u000a							$('#UFP_state_thumbnail > img').attr('src', ((data.thumbnail) ? data.thumbnail : 'plugin/UltimakerFormatPackage/thumbnail/' + data.path.replace('.ufp.gcode','.png')));\u000a						} else {\u000a							$('#state > div > hr:first').after('<div id="UFP_state_thumbnail" class="row-fluid"><img src="'+((data.thumbnail) ? data.thumbnail : 'plugin/UltimakerFormatPackage/thumbnail/' + data.path.replace('.ufp.gcode','.png'))+'" width="100%"/>\u005cn<hr/></div>');\u000a						}\u000a					} else {\u000a						$('#UFP_state_thumbnail').remove();\u000a					}\u000a				} else {\u000a					$('#UFP_state_thumbnail').remove();\u000a				}\u000a			});\u000a		}\u000a\u000a		$(document).ready(function(){\u000a			let regex = /<div class="btn-group action-buttons">([\u005cs\u005cS]*)<.div>/mi;\u000a			let template = '<div class="btn btn-mini" data-bind="click: function() { if ($root.loginState.isUser()) { $root.UltimakerFormatPackage_open_thumbnail($data) } else { return; } }, visible: (($data.thumbnail_src == \u005c'UltimakerFormatPackage\u005c' || $data.name.indexOf(\u005c'.ufp.gcode\u005c') > -1) && $root.settingsViewModel.settings.plugins.UltimakerFormatPackage.inline_thumbnail() == false)" title="Show Thumbnail" style="display: none;"><i class="fa fa-image"></i></div>';\u000a			let inline_thumbnail_template = '<div class="row-fluid inline_thumbnail" ' +\u000a			                                'data-bind="if: (($data.thumbnail_src == \u005c'UltimakerFormatPackage\u005c' || $data.name.indexOf(\u005c'.ufp.gcode\u005c') > -1) && $root.settingsViewModel.settings.plugins.UltimakerFormatPackage.inline_thumbnail() == true), style: {\u005c'text-align\u005c': $root.thumbnailAlignValue}">' +\u000a			                                '<img data-bind="attr: {src: (($data.thumbnail) ? $data.thumbnail : \u005c'plugin/UltimakerFormatPackage/thumbnail/\u005c' + $data.path.replace(\u005c'.ufp.gcode\u005c',\u005c'.png\u005c')), width: $root.thumbnailScaleValue}, ' +\u000a			                                'visible: (($data.thumbnail_src == \u005c'UltimakerFormatPackage\u005c' || $data.name.indexOf(\u005c'.ufp.gcode\u005c') > -1) && $root.settingsViewModel.settings.plugins.UltimakerFormatPackage.inline_thumbnail() == true), ' +\u000a			                                'click: function() { if ($root.loginState.isUser()) { $root.UltimakerFormatPackage_open_thumbnail($data) } else { return; } }" ' +\u000a			                                'style="display: none;"/></div>'\u000a\u000a			$("#files_template_machinecode").text(function () {\u000a				var return_value = inline_thumbnail_template + $(this).text();\u000a				return_value = return_value.replace(regex, '<div class="btn-group action-buttons">$1	' + template + '></div>');\u000a				return return_value\u000a			});\u000a		});\u000a	}\u000a\u000a	OCTOPRINT_VIEWMODELS.push({\u000a		construct: UltimakerformatpackageViewModel,\u000a		dependencies: ['settingsViewModel', 'filesViewModel'],\u000a		elements: ['div#UltimakerFormatPackage_thumbnail_viewer', '#ufp_crawl_files', '#ufp_crawl_files_results']\u000a	});\u000a});\u000a\u000a;\u000a
p0
.