V// source: js/app/helpers.js\u000afunction ItemListHelper(\u000a    listType,\u000a    supportedSorting,\u000a    supportedFilters,\u000a    defaultSorting,\u000a    defaultFilters,\u000a    exclusiveFilters,\u000a    defaultPageSize,\u000a    persistPageSize\u000a) {\u000a    var self = this;\u000a\u000a    self.listType = listType;\u000a    self.supportedSorting = supportedSorting;\u000a    self.supportedFilters = supportedFilters;\u000a    self.defaultSorting = defaultSorting;\u000a    self.defaultFilters = defaultFilters;\u000a    self.exclusiveFilters = exclusiveFilters;\u000a    self.defaultPageSize = defaultPageSize;\u000a    self.persistPageSize = !!persistPageSize;\u000a\u000a    self.searchFunction = undefined;\u000a\u000a    self.allItems = [];\u000a    self.allSize = ko.observable(0);\u000a\u000a    self.items = ko.observableArray([]);\u000a    self.pageSize = ko.observable(self.defaultPageSize);\u000a    self.currentPage = ko.observable(0);\u000a    self.currentSorting = ko.observable(self.defaultSorting);\u000a    self.currentFilters = ko.observableArray(self.defaultFilters);\u000a    self.selectedItem = ko.observable(undefined);\u000a    self.filterSearch = ko.observable(true);\u000a\u000a    self.storageIds = {\u000a        currentSorting: self.listType + "." + "currentSorting",\u000a        currentFilters: self.listType + "." + "currentFilters",\u000a        pageSize: self.listType + "." + "pageSize"\u000a    };\u000a\u000a    //~~ item handling\u000a\u000a    self.refresh = function () {\u000a        self._updateItems();\u000a    };\u000a\u000a    self.updateItems = function (items) {\u000a        if (items === undefined) items = [];\u000a        self.allItems = items;\u000a        self.allSize(items.length);\u000a        self._updateItems();\u000a    };\u000a\u000a    self.selectItem = function (matcher) {\u000a        var itemList = self.items();\u000a        for (var i = 0; i < itemList.length; i++) {\u000a            if (matcher(itemList[i])) {\u000a                self.selectedItem(itemList[i]);\u000a                break;\u000a            }\u000a        }\u000a    };\u000a\u000a    self.selectNone = function () {\u000a        self.selectedItem(undefined);\u000a    };\u000a\u000a    self.isSelected = function (data) {\u000a        return self.selectedItem() === data;\u000a    };\u000a\u000a    self.isSelectedByMatcher = function (matcher) {\u000a        return matcher(self.selectedItem());\u000a    };\u000a\u000a    self.removeItem = function (matcher) {\u000a        var index = self.getIndex(matcher, true);\u000a        if (index > -1) {\u000a            self.allItems.splice(index, 1);\u000a            self._updateItems();\u000a        }\u000a    };\u000a\u000a    self.updateItem = function (matcher, item) {\u000a        var index = self.allItems.findIndex(matcher);\u000a        if (index > -1) {\u000a            self.allItems[index] = item;\u000a            self._updateItems();\u000a        }\u000a    };\u000a\u000a    self.addItem = function (item) {\u000a        self.allItems.push(item);\u000a        self._updateItems();\u000a    };\u000a\u000a    //~~ pagination\u000a\u000a    self.paginatedItems = ko.dependentObservable(function () {\u000a        if (self.items() === undefined) {\u000a            return [];\u000a        } else if (self.pageSize() === 0) {\u000a            return self.items();\u000a        } else {\u000a            var from = Math.max(self.currentPage() * self.pageSize(), 0);\u000a            var to = Math.min(from + self.pageSize(), self.items().length);\u000a            return self.items().slice(from, to);\u000a        }\u000a    });\u000a    self.lastPage = ko.dependentObservable(function () {\u000a        return self.pageSize() === 0\u000a            ? 1\u000a            : Math.ceil(self.items().length / self.pageSize()) - 1;\u000a    });\u000a    self.pages = ko.dependentObservable(function () {\u000a        var pages = [];\u000a        var i;\u000a\u000a        if (self.pageSize() === 0) {\u000a            pages.push({number: 0, text: 1});\u000a        } else if (self.lastPage() < 7) {\u000a            for (i = 0; i < self.lastPage() + 1; i++) {\u000a                pages.push({number: i, text: i + 1});\u000a            }\u000a        } else {\u000a            pages.push({number: 0, text: 1});\u000a            if (self.currentPage() < 5) {\u000a                for (i = 1; i < 5; i++) {\u000a                    pages.push({number: i, text: i + 1});\u000a                }\u000a                pages.push({number: -1, text: "\u2026"});\u000a            } else if (self.currentPage() > self.lastPage() - 5) {\u000a                pages.push({number: -1, text: "\u2026"});\u000a                for (i = self.lastPage() - 4; i < self.lastPage(); i++) {\u000a                    pages.push({number: i, text: i + 1});\u000a                }\u000a            } else {\u000a                pages.push({number: -1, text: "\u2026"});\u000a                for (i = self.currentPage() - 1; i <= self.currentPage() + 1; i++) {\u000a                    pages.push({number: i, text: i + 1});\u000a                }\u000a                pages.push({number: -1, text: "\u2026"});\u000a            }\u000a            pages.push({number: self.lastPage(), text: self.lastPage() + 1});\u000a        }\u000a        return pages;\u000a    });\u000a\u000a    self.switchToItem = function (matcher) {\u000a        var pos = -1;\u000a        var itemList = self.items();\u000a        for (var i = 0; i < itemList.length; i++) {\u000a            if (matcher(itemList[i])) {\u000a                pos = i;\u000a                break;\u000a            }\u000a        }\u000a\u000a        if (pos > -1) {\u000a            var page = Math.floor(pos / self.pageSize());\u000a            self.changePage(page);\u000a        }\u000a    };\u000a\u000a    self.changePage = function (newPage) {\u000a        if (newPage < 0 || newPage > self.lastPage()) return;\u000a        self.currentPage(newPage);\u000a    };\u000a    self.prevPage = function () {\u000a        if (self.currentPage() > 0) {\u000a            self.currentPage(self.currentPage() - 1);\u000a        }\u000a    };\u000a    self.nextPage = function () {\u000a        if (self.currentPage() < self.lastPage()) {\u000a            self.currentPage(self.currentPage() + 1);\u000a        }\u000a    };\u000a\u000a    self.getIndex = function (matcher, all) {\u000a        var itemList;\u000a        if (all !== undefined && all === true) {\u000a            itemList = self.allItems;\u000a        } else {\u000a            itemList = self.items();\u000a        }\u000a\u000a        for (var i = 0; i < itemList.length; i++) {\u000a            if (matcher(itemList[i])) {\u000a                return i;\u000a            }\u000a        }\u000a        return -1;\u000a    };\u000a\u000a    self.getItem = function (matcher, all) {\u000a        var index = self.getIndex(matcher, all);\u000a        if (all !== undefined && all === true) {\u000a            return index > -1 ? self.allItems[index] : undefined;\u000a        } else {\u000a            return index > -1 ? self.items()[index] : undefined;\u000a        }\u000a    };\u000a\u000a    self.resetPage = function () {\u000a        if (self.currentPage() > self.lastPage()) {\u000a            self.currentPage(self.lastPage());\u000a        }\u000a    };\u000a\u000a    //~~ searching\u000a\u000a    self.changeSearchFunction = function (searchFunction) {\u000a        self.searchFunction = searchFunction;\u000a        self.changePage(0);\u000a        self._updateItems();\u000a    };\u000a\u000a    self.resetSearch = function () {\u000a        self.changeSearchFunction(undefined);\u000a    };\u000a\u000a    //~~ sorting\u000a\u000a    self.changeSorting = function (sorting) {\u000a        if (!_.contains(_.keys(self.supportedSorting), sorting)) return;\u000a\u000a        self.currentSorting(sorting);\u000a        self._saveCurrentSortingToLocalStorage();\u000a\u000a        self.changePage(0);\u000a        self._updateItems();\u000a    };\u000a\u000a    //~~ filtering\u000a\u000a    self.setFilterSearch = function (enabled) {\u000a        if (self.filterSearch() === enabled) return;\u000a\u000a        self.filterSearch(enabled);\u000a        self.changePage(0);\u000a        self._updateItems();\u000a    };\u000a\u000a    self.toggleFilterSearch = function () {\u000a        self.setFilterSearch(!self.filterSearch());\u000a    };\u000a\u000a    self.toggleFilter = function (filter) {\u000a        if (!_.contains(_.keys(self.supportedFilters), filter)) return;\u000a\u000a        if (_.contains(self.currentFilters(), filter)) {\u000a            self.removeFilter(filter);\u000a        } else {\u000a            self.addFilter(filter);\u000a        }\u000a    };\u000a\u000a    self.addFilter = function (filter) {\u000a        if (!_.contains(_.keys(self.supportedFilters), filter)) return;\u000a\u000a        for (var i = 0; i < self.exclusiveFilters.length; i++) {\u000a            if (_.contains(self.exclusiveFilters[i], filter)) {\u000a                for (var j = 0; j < self.exclusiveFilters[i].length; j++) {\u000a                    if (self.exclusiveFilters[i][j] === filter) continue;\u000a                    self.removeFilter(self.exclusiveFilters[i][j]);\u000a                }\u000a            }\u000a        }\u000a\u000a        var filters = self.currentFilters();\u000a        filters.push(filter);\u000a        self.currentFilters(filters);\u000a        self._saveCurrentFiltersToLocalStorage();\u000a\u000a        self.changePage(0);\u000a        self._updateItems();\u000a    };\u000a\u000a    self.removeFilter = function (filter) {\u000a        if (!_.contains(_.keys(self.supportedFilters), filter)) return;\u000a\u000a        var filters = self.currentFilters();\u000a        filters = _.without(filters, filter);\u000a        self.currentFilters(filters);\u000a        self._saveCurrentFiltersToLocalStorage();\u000a\u000a        self.changePage(0);\u000a        self._updateItems();\u000a    };\u000a\u000a    //~~ update for sorted and filtered view\u000a\u000a    self._updateItems = function () {\u000a        // determine comparator\u000a        var comparator = undefined;\u000a        var currentSorting = self.currentSorting();\u000a        if (\u000a            typeof currentSorting !== "undefined" &&\u000a            typeof self.supportedSorting[currentSorting] !== "undefined"\u000a        ) {\u000a            comparator = self.supportedSorting[currentSorting];\u000a        }\u000a\u000a        // work on all items\u000a        var result = self.allItems;\u000a\u000a        var hasSearch = typeof self.searchFunction !== "undefined" && self.searchFunction;\u000a\u000a        // filter if we're not searching or have search filtering enabled\u000a        if (!hasSearch || self.filterSearch()) {\u000a            var filters = self.currentFilters();\u000a            _.each(filters, function (filter) {\u000a                if (\u000a                    typeof filter !== "undefined" &&\u000a                    typeof supportedFilters[filter] !== "undefined"\u000a                )\u000a                    result = _.filter(result, supportedFilters[filter]);\u000a            });\u000a        }\u000a\u000a        // search if necessary\u000a        if (hasSearch) {\u000a            result = _.filter(result, self.searchFunction);\u000a        }\u000a\u000a        // sort if necessary\u000a        if (typeof comparator !== "undefined") result.sort(comparator);\u000a\u000a        // set result list\u000a        self.items(result);\u000a    };\u000a\u000a    //~~ local storage\u000a\u000a    self._saveCurrentSortingToLocalStorage = function () {\u000a        if (self._initializeLocalStorage()) {\u000a            var currentSorting = self.currentSorting();\u000a            if (currentSorting !== undefined)\u000a                localStorage[self.storageIds.currentSorting] = currentSorting;\u000a            else localStorage[self.storageIds.currentSorting] = undefined;\u000a        }\u000a    };\u000a\u000a    self._loadCurrentSortingFromLocalStorage = function () {\u000a        if (self._initializeLocalStorage()) {\u000a            if (\u000a                _.contains(\u000a                    _.keys(supportedSorting),\u000a                    localStorage[self.storageIds.currentSorting]\u000a                )\u000a            )\u000a                self.currentSorting(localStorage[self.storageIds.currentSorting]);\u000a            else self.currentSorting(defaultSorting);\u000a        }\u000a    };\u000a\u000a    self._saveCurrentFiltersToLocalStorage = function () {\u000a        if (self._initializeLocalStorage()) {\u000a            var filters = _.intersection(\u000a                _.keys(self.supportedFilters),\u000a                self.currentFilters()\u000a            );\u000a            localStorage[self.storageIds.currentFilters] = JSON.stringify(filters);\u000a        }\u000a    };\u000a\u000a    self._loadCurrentFiltersFromLocalStorage = function () {\u000a        if (self._initializeLocalStorage()) {\u000a            self.currentFilters(\u000a                _.intersection(\u000a                    _.keys(self.supportedFilters),\u000a                    JSON.parse(localStorage[self.storageIds.currentFilters])\u000a                )\u000a            );\u000a        }\u000a    };\u000a\u000a    self._savePageSizeToLocalStorage = function (pageSize) {\u000a        if (self._initializeLocalStorage() && self.persistPageSize) {\u000a            localStorage[self.storageIds.pageSize] = pageSize;\u000a        }\u000a    };\u000a\u000a    self.pageSize.subscribe(self._savePageSizeToLocalStorage);\u000a\u000a    self._loadPageSizeFromLocalStorage = function () {\u000a        if (self._initializeLocalStorage() && self.persistPageSize) {\u000a            self.pageSize(parseInt(localStorage[self.storageIds.pageSize]));\u000a        }\u000a    };\u000a\u000a    self._initializeLocalStorage = function () {\u000a        if (!Modernizr.localstorage) return false;\u000a\u000a        if (\u000a            localStorage[self.storageIds.currentSorting] !== undefined &&\u000a            localStorage[self.storageIds.currentFilters] !== undefined &&\u000a            JSON.parse(localStorage[self.storageIds.currentFilters]) instanceof Array &&\u000a            localStorage[self.storageIds.pageSize] !== undefined\u000a        )\u000a            return true;\u000a\u000a        localStorage[self.storageIds.currentSorting] = self.defaultSorting;\u000a        localStorage[self.storageIds.currentFilters] = JSON.stringify(\u000a            self.defaultFilters\u000a        );\u000a        localStorage[self.storageIds.pageSize] = self.defaultPageSize;\u000a\u000a        return true;\u000a    };\u000a\u000a    self._loadCurrentFiltersFromLocalStorage();\u000a    self._loadCurrentSortingFromLocalStorage();\u000a    self._loadPageSizeFromLocalStorage();\u000a}\u000a\u000afunction formatSize(bytes) {\u000a    if (!bytes) return "-";\u000a\u000a    var units = ["bytes", "KB", "MB", "GB"];\u000a    for (var i = 0; i < units.length; i++) {\u000a        if (bytes < 1024) {\u000a            return _.sprintf("%3.1f%s", bytes, units[i]);\u000a        }\u000a        bytes /= 1024;\u000a    }\u000a    return _.sprintf("%.1f%s", bytes, "TB");\u000a}\u000a\u000afunction formatHuman(number) {\u000a    if (number === undefined) return "-";\u000a    if (number < 1000) return number;\u000a\u000a    return _.sprintf("%.1fK", number / 1000);\u000a}\u000a\u000afunction bytesFromSize(size) {\u000a    if (size === undefined || size.trim() === "") return undefined;\u000a\u000a    var parsed = size.match(/^([+]?[0-9]*\u005c.?[0-9]+)(?:\u005cs*)?(.*)$/);\u000a    var number = parsed[1];\u000a    var unit = parsed[2].trim();\u000a\u000a    if (unit === "") return parseFloat(number);\u000a\u000a    var units = {\u000a        b: 1,\u000a        byte: 1,\u000a        bytes: 1,\u000a        kb: 1024,\u000a        mb: Math.pow(1024, 2),\u000a        gb: Math.pow(1024, 3),\u000a        tb: Math.pow(1024, 4)\u000a    };\u000a    unit = unit.toLowerCase();\u000a\u000a    if (!units.hasOwnProperty(unit)) {\u000a        return undefined;\u000a    }\u000a\u000a    var factor = units[unit];\u000a    return number * factor;\u000a}\u000a\u000afunction formatDuration(seconds) {\u000a    if (!seconds) return "-";\u000a    if (seconds < 1) return "00:00:00";\u000a\u000a    var s = seconds % 60;\u000a    var m = (seconds % 3600) / 60;\u000a    var h = seconds / 3600;\u000a\u000a    return _.sprintf(\u000a        gettext(/* L10N: duration format */ "%(hour)02d:%(minute)02d:%(second)02d"),\u000a        {hour: h, minute: m, second: s}\u000a    );\u000a}\u000a\u000afunction formatFuzzyEstimation(seconds, base) {\u000a    if (!seconds || seconds < 1) return "-";\u000a\u000a    var m;\u000a    if (base !== undefined) {\u000a        m = moment(base);\u000a    } else {\u000a        m = moment();\u000a    }\u000a\u000a    m.add(seconds, "s");\u000a    return m.fromNow(true);\u000a}\u000a\u000afunction formatFuzzyPrintTime(totalSeconds) {\u000a    /**\u000a     * Formats a print time estimate in a very fuzzy way.\u000a     *\u000a     * Accuracy decreases the higher the estimation is:\u000a     *\u000a     *   * less than 30s: "a few seconds"\u000a     *   * 30s to a minute: "less than a minute"\u000a     *   * 1 to 30min: rounded to full minutes, above 30s is minute + 1 ("27 minutes", "2 minutes")\u000a     *   * 30min to 40min: "40 minutes"\u000a     *   * 40min to 50min: "50 minutes"\u000a     *   * 50min to 1h: "1 hour"\u000a     *   * 1 to 12h: rounded to half hours, 15min to 45min is ".5", above that hour + 1 ("4 hours", "2.5 hours")\u000a     *   * 12 to 24h: rounded to full hours, above 30min is hour + 1, over 23.5h is "1 day"\u000a     *   * Over a day: rounded to half days, 8h to 16h is ".5", above that days + 1 ("1 day", "4 days", "2.5 days")\u000a     */\u000a\u000a    if (!totalSeconds || totalSeconds < 1) return "-";\u000a\u000a    var d = moment.duration(totalSeconds, "seconds");\u000a\u000a    var seconds = d.seconds();\u000a    var minutes = d.minutes();\u000a    var hours = d.hours();\u000a    var days = d.days();\u000a\u000a    var replacements = {\u000a        days: days,\u000a        hours: hours,\u000a        minutes: minutes,\u000a        seconds: seconds,\u000a        totalSeconds: totalSeconds\u000a    };\u000a\u000a    var text = "-";\u000a\u000a    if (days >= 1) {\u000a        // days\u000a        if (hours >= 16) {\u000a            replacements.days += 1;\u000a\u000a            if (replacements.days === 1) {\u000a                text = gettext("%(days)d day");\u000a            } else {\u000a                text = gettext("%(days)d days");\u000a            }\u000a        } else if (hours >= 8 && hours < 16) {\u000a            text = gettext("%(days)d.5 days");\u000a        } else {\u000a            if (days === 1) {\u000a                text = gettext("%(days)d day");\u000a            } else {\u000a                text = gettext("%(days)d days");\u000a            }\u000a        }\u000a    } else if (hours >= 1) {\u000a        // only hours\u000a        if (hours < 12) {\u000a            if (minutes < 15) {\u000a                // less than .15 => .0\u000a                if (hours === 1) {\u000a                    text = gettext("%(hours)d hour");\u000a                } else {\u000a                    text = gettext("%(hours)d hours");\u000a                }\u000a            } else if (minutes >= 15 && minutes < 45) {\u000a                // between .25 and .75 => .5\u000a                text = gettext("%(hours)d.5 hours");\u000a            } else {\u000a                // over .75 => hours + 1\u000a                replacements.hours += 1;\u000a\u000a                if (replacements.hours === 1) {\u000a                    text = gettext("%(hours)d hour");\u000a                } else {\u000a                    text = gettext("%(hours)d hours");\u000a                }\u000a            }\u000a        } else {\u000a            if (hours === 23 && minutes > 30) {\u000a                // over 23.5 hours => 1 day\u000a                text = gettext("1 day");\u000a            } else {\u000a                if (minutes > 30) {\u000a                    // over .5 => hours + 1\u000a                    replacements.hours += 1;\u000a                }\u000a                text = gettext("%(hours)d hours");\u000a            }\u000a        }\u000a    } else if (minutes >= 1) {\u000a        // only minutes\u000a        if (minutes < 2) {\u000a            if (seconds < 30) {\u000a                text = gettext("a minute");\u000a            } else {\u000a                text = gettext("2 minutes");\u000a            }\u000a        } else if (minutes < 30) {\u000a            if (seconds > 30) {\u000a                replacements.minutes += 1;\u000a            }\u000a            text = gettext("%(minutes)d minutes");\u000a        } else if (minutes <= 40) {\u000a            text = gettext("40 minutes");\u000a        } else if (minutes <= 50) {\u000a            text = gettext("50 minutes");\u000a        } else {\u000a            text = gettext("1 hour");\u000a        }\u000a    } else {\u000a        // only seconds\u000a        if (seconds < 30) {\u000a            text = gettext("a few seconds");\u000a        } else {\u000a            text = gettext("less than a minute");\u000a        }\u000a    }\u000a\u000a    return _.sprintf(text, replacements);\u000a}\u000a\u000afunction formatDate(unixTimestamp, options) {\u000a    if (!options) {\u000a        options = {seconds: false};\u000a    }\u000a\u000a    if (!unixTimestamp) return "-";\u000a\u000a    var format = gettext(/* L10N: Date format */ "YYYY-MM-DD HH:mm");\u000a    if (options.seconds) {\u000a        format = gettext(/* L10N: Date format with seconds */ "YYYY-MM-DD HH:mm:ss");\u000a    }\u000a\u000a    return moment.unix(unixTimestamp).format(format);\u000a}\u000a\u000afunction formatTimeAgo(unixTimestamp) {\u000a    if (!unixTimestamp) return "-";\u000a    return moment.unix(unixTimestamp).fromNow();\u000a}\u000a\u000afunction formatFilament(filament) {\u000a    if (!filament || !filament["length"]) return "-";\u000a    var result = "%(length).02fm";\u000a    if (filament.hasOwnProperty("volume") && filament.volume) {\u000a        result += " / " + "%(volume).02fcm³";\u000a    }\u000a    return _.sprintf(result, {\u000a        length: filament["length"] / 1000,\u000a        volume: filament["volume"]\u000a    });\u000a}\u000a\u000afunction cleanTemperature(temp, offThreshold) {\u000a    if (temp === undefined || !_.isNumber(temp)) return "-";\u000a    if (offThreshold !== undefined && temp < offThreshold) return gettext("off");\u000a    return temp;\u000a}\u000a\u000afunction formatTemperature(temp, showF, offThreshold) {\u000a    if (temp === undefined || !_.isNumber(temp)) return "-";\u000a    if (offThreshold !== undefined && temp < offThreshold) return gettext("off");\u000a    if (showF) {\u000a        return _.sprintf("%.1f&deg;C (%.1f&deg;F)", temp, (temp * 9) / 5 + 32);\u000a    } else {\u000a        return _.sprintf("%.1f&deg;C", temp);\u000a    }\u000a}\u000a\u000afunction formatNumberK(num) {\u000a    if (num > 1000) {\u000a        num = num / 1000.0;\u000a        return _.sprintf("%.2fk", num);\u000a    } else {\u000a        return _.sprintf("%i", num);\u000a    }\u000a}\u000a\u000afunction pnotifyAdditionalInfo(inner) {\u000a    return (\u000a        '<div class="pnotify_additional_info">' +\u000a        '<div class="pnotify_more"><a href="#" onclick="$(this).children().toggleClass(\u005c'icon-caret-right icon-caret-down\u005c').parent().parent().next().slideToggle(\u005c'fast\u005c')">More <i class="icon-caret-right"></i></a></div>' +\u000a        '<div class="pnotify_more_container hide">' +\u000a        inner +\u000a        "</div>" +\u000a        "</div>"\u000a    );\u000a}\u000a\u000afunction ping(url, callback) {\u000a    var img = new Image();\u000a    var calledBack = false;\u000a\u000a    img.onload = function () {\u000a        callback(true);\u000a        calledBack = true;\u000a    };\u000a    img.onerror = function () {\u000a        if (!calledBack) {\u000a            callback(true);\u000a            calledBack = true;\u000a        }\u000a    };\u000a    img.src = url;\u000a    setTimeout(function () {\u000a        if (!calledBack) {\u000a            callback(false);\u000a            calledBack = true;\u000a        }\u000a    }, 1500);\u000a}\u000a\u000afunction showOfflineOverlay(title, message, reconnectCallback) {\u000a    if (title === undefined) {\u000a        title = gettext("Server is offline");\u000a    }\u000a\u000a    $("#offline_overlay_title").text(title);\u000a    $("#offline_overlay_message").html(message);\u000a    $("#offline_overlay_reconnect").click(reconnectCallback);\u000a\u000a    var overlay = $("#offline_overlay");\u000a    if (!overlay.is(":visible")) overlay.show();\u000a}\u000a\u000afunction hideOfflineOverlay() {\u000a    $("#offline_overlay").hide();\u000a}\u000a\u000afunction showMessageDialog(msg, options) {\u000a    options = options || {};\u000a    if (_.isPlainObject(msg)) {\u000a        options = msg;\u000a    } else {\u000a        options.message = msg;\u000a    }\u000a\u000a    var title = options.title || "";\u000a    var message = options.message || "";\u000a    var close = options.close || gettext("Close");\u000a    var onclose = options.onclose || undefined;\u000a    var onshow = options.onshow || undefined;\u000a    var onshown = options.onshown || undefined;\u000a    var nofade = options.nofade || false;\u000a\u000a    if (_.isString(message)) {\u000a        message = $("<p>" + message + "</p>");\u000a    }\u000a\u000a    var modalHeader = $(\u000a        '<a href="javascript:void(0)" class="close" data-dismiss="modal" aria-hidden="true">&times;</a><h3>' +\u000a            title +\u000a            "</h3>"\u000a    );\u000a    var modalBody = $(message);\u000a    var modalFooter = $(\u000a        '<a href="javascript:void(0)" class="btn" data-dismiss="modal" aria-hidden="true">' +\u000a            close +\u000a            "</a>"\u000a    );\u000a\u000a    var modal = $("<div></div>").addClass("modal hide");\u000a    if (!nofade) {\u000a        modal.addClass("fade");\u000a    }\u000a    modal\u000a        .append($("<div></div>").addClass("modal-header").append(modalHeader))\u000a        .append($("<div></div>").addClass("modal-body").append(modalBody))\u000a        .append($("<div></div>").addClass("modal-footer").append(modalFooter));\u000a\u000a    modal.on("hidden", function () {\u000a        if (onclose && _.isFunction(onclose)) {\u000a            onclose();\u000a        }\u000a    });\u000a\u000a    if (onshow) {\u000a        modal.on("show", onshow);\u000a    }\u000a\u000a    if (onshown) {\u000a        modal.on("shown", onshown);\u000a    }\u000a\u000a    modal.modal("show");\u000a    return modal;\u000a}\u000a\u000afunction showConfirmationDialog(msg, onacknowledge, options) {\u000a    options = options || {};\u000a    if (_.isPlainObject(msg)) {\u000a        options = msg;\u000a    } else {\u000a        options.message = msg;\u000a        options.onproceed = onacknowledge;\u000a    }\u000a\u000a    var title = options.title || gettext("Are you sure?");\u000a\u000a    var message = options.message || "";\u000a    var question = options.question || gettext("Are you sure you want to proceed?");\u000a\u000a    var html = options.html;\u000a\u000a    var checkboxes = options.checkboxes;\u000a\u000a    var cancel = options.cancel || gettext("Cancel");\u000a    var proceed = options.proceed || gettext("Proceed");\u000a    var proceedClass = options.proceedClass || "danger";\u000a    var onproceed = options.onproceed || undefined;\u000a    var oncancel = options.oncancel || undefined;\u000a    var onclose = options.onclose || undefined;\u000a    var dialogClass = options.dialogClass || "";\u000a    var nofade = options.nofade || false;\u000a    var noclose = options.noclose || false;\u000a\u000a    var modalHeader;\u000a    if (noclose) {\u000a        modalHeader = $("<h3>" + title + "</h3>");\u000a    } else {\u000a        modalHeader = $(\u000a            '<a href="javascript:void(0)" class="close" data-dismiss="modal" aria-hidden="true">&times;</a><h3>' +\u000a                title +\u000a                "</h3>"\u000a        );\u000a    }\u000a\u000a    var modalBody;\u000a    if (html) {\u000a        modalBody = $(html);\u000a    } else {\u000a        modalBody = $("<p>" + message + "</p><p>" + question + "</p>");\u000a    }\u000a\u000a    var cancelButton = $('<a href="javascript:void(0)" class="btn">' + cancel + "</a>")\u000a        .attr("data-dismiss", "modal")\u000a        .attr("aria-hidden", "true");\u000a\u000a    if (!_.isArray(proceed)) {\u000a        proceed = [proceed];\u000a    }\u000a\u000a    var proceedButtons = [];\u000a    _.each(proceed, function (text) {\u000a        proceedButtons.push(\u000a            $('<a href="javascript:void(0)" class="btn">' + text + "</a>").addClass(\u000a                "btn-" + proceedClass\u000a            )\u000a        );\u000a    });\u000a\u000a    var modal = $("<div></div>").addClass("modal hide");\u000a    if (!nofade) {\u000a        modal.addClass("fade");\u000a    }\u000a\u000a    var buttons = $("<div></div>").addClass("modal-footer").append(cancelButton);\u000a    _.each(proceedButtons, function (button) {\u000a        buttons.append(button);\u000a    });\u000a\u000a    modal\u000a        .addClass(dialogClass)\u000a        .append($("<div></div>").addClass("modal-header").append(modalHeader))\u000a        .append($("<div></div>").addClass("modal-body").append(modalBody))\u000a        .append(buttons);\u000a    modal.on("hidden", function (event) {\u000a        if (onclose && _.isFunction(onclose)) {\u000a            onclose(event);\u000a        }\u000a    });\u000a\u000a    var modalOptions = {};\u000a    if (noclose) {\u000a        modalOptions.backdrop = "static";\u000a        modalOptions.keyboard = false;\u000a    }\u000a    modal.modal(modalOptions);\u000a\u000a    _.each(proceedButtons, function (button, idx) {\u000a        button.click(function (e) {\u000a            e.preventDefault();\u000a            if (onproceed && _.isFunction(onproceed)) {\u000a                onproceed(idx, e);\u000a            }\u000a            modal.modal("hide");\u000a        });\u000a    });\u000a    cancelButton.click(function (e) {\u000a        if (oncancel && _.isFunction(oncancel)) {\u000a            oncancel(e);\u000a        }\u000a    });\u000a\u000a    return modal;\u000a}\u000a\u000afunction showSelectionDialog(options) {\u000a    var title = options.title;\u000a    var message = options.message || undefined;\u000a    var selections = options.selections || [];\u000a\u000a    var maycancel = options.maycancel || false;\u000a    var cancel = options.cancel || undefined;\u000a    var onselect = options.onselect || undefined;\u000a    var onclose = options.onclose || undefined;\u000a    var dialogClass = options.dialogClass || "";\u000a    var nofade = options.nofade || false;\u000a\u000a    // header\u000a    var modalHeader;\u000a    if (maycancel) {\u000a        modalHeader = $(\u000a            '<a href="javascript:void(0)" class="close" data-dismiss="modal" aria-hidden="true">&times;</a><h3>' +\u000a                title +\u000a                "</h3>"\u000a        );\u000a    } else {\u000a        modalHeader = $("<h3>" + title + "</h3>");\u000a    }\u000a\u000a    // body\u000a    var buttons = [];\u000a    var selectionBody = $("<div></div>");\u000a    var container;\u000a    var additionalClass;\u000a\u000a    if (selections.length === 1) {\u000a        container = selectionBody;\u000a        additionalClass = "btn-block";\u000a    } else if (selections.length === 2) {\u000a        container = $("<div class='row-fluid'></div>");\u000a        selectionBody.append(container);\u000a        additionalClass = "span6";\u000a    } else {\u000a        container = selectionBody;\u000a        additionalClass = "btn-block";\u000a    }\u000a\u000a    _.each(selections, function (s, i) {\u000a        var button = $(\u000a            '<button class="btn" style="white-space: normal; word-wrap: break-word" data-index="' +\u000a                i +\u000a                '">' +\u000a                selections[i] +\u000a                "</button>"\u000a        );\u000a        if (additionalClass) {\u000a            button.addClass(additionalClass);\u000a        }\u000a        container.append(button);\u000a        buttons.push(button);\u000a\u000a        if (selections.length > 2 && i < selections.length - 1) {\u000a            container = $("<div class='row-fluid'></div>");\u000a            selectionBody.append(container);\u000a        }\u000a    });\u000a\u000a    // divs\u000a    var headerDiv = $("<div></div>").addClass("modal-header").append(modalHeader);\u000a\u000a    var bodyDiv = $("<div></div>").addClass("modal-body");\u000a    if (message) {\u000a        bodyDiv.append($("<p>" + message + "</p>"));\u000a    }\u000a    bodyDiv.append(selectionBody);\u000a\u000a    // create modal and do final wiring up\u000a    var modal = $("<div></div>").addClass("modal hide");\u000a    if (!nofade) {\u000a        modal.addClass("fade");\u000a    }\u000a    if (!cancel) {\u000a        modal.data("backdrop", "static").data("keyboard", "false");\u000a    }\u000a\u000a    modal.addClass(dialogClass).append(headerDiv).append(bodyDiv);\u000a    modal.on("hidden", function (event) {\u000a        if (onclose && _.isFunction(onclose)) {\u000a            onclose(event);\u000a        }\u000a    });\u000a    modal.modal("show");\u000a\u000a    _.each(buttons, function (button) {\u000a        button.click(function (e) {\u000a            e.preventDefault();\u000a            var index = button.data("index");\u000a            if (index < 0) {\u000a                return;\u000a            }\u000a\u000a            if (onselect && _.isFunction(onselect)) {\u000a                onselect(index, e);\u000a            }\u000a            modal.modal("hide");\u000a        });\u000a    });\u000a\u000a    return modal;\u000a}\u000a\u000a/**\u000a * Shows a progress modal depending on a supplied promise.\u000a *\u000a * Will listen to the supplied promise, update the progress on .progress events and\u000a * enabling the close button and (optionally) closing the dialog on promise resolve.\u000a *\u000a * The calling code should call "notify" on the deferred backing the promise and supply:\u000a *\u000a *   * the text to display on the progress bar and the optional output field and\u000a *     a boolean value indicating whether the operation behind that update was successful or not\u000a *   * a short text to display on the progress bar, a long text to display on the optional output\u000a *     field and a boolean value indicating whether the operation behind that update was\u000a *     successful or not\u000a *\u000a * Non-successful progress updates will remove the barClassSuccess class from the progress bar and\u000a * apply the barClassFailure class and also apply the outputClassFailure to the produced line\u000a * in the output.\u000a *\u000a * To determine the progress, calling code should supply the prognosed maximum number of\u000a * progress events. An internal counter will increment on each progress event and used together\u000a * with the max value to calculate the percentage to display on the progress bar.\u000a *\u000a * If no max value is set, the progress bar will show a striped animation at 100% fill status\u000a * to visualize "unknown but ongoing" status.\u000a *\u000a * Available options:\u000a *\u000a *   * title: the title of the modal, defaults to "Progress"\u000a *   * message: the message of the modal, defaults to ""\u000a *   * buttonText: the text on the close button, defaults to "Close"\u000a *   * max: maximum number of expected progress events (when 100% will be reached), defaults\u000a *     to undefined\u000a *   * close: whether to close the dialog on completion, defaults to false\u000a *   * output: whether to display the progress texts in an output field, defaults to false\u000a *   * dialogClass: additional class to apply to the dialog div\u000a *   * barClassSuccess: additional class for the progress bar while all progress events are\u000a *     successful\u000a *   * barClassFailure: additional class for the progress bar when a progress event was\u000a *     unsuccessful\u000a *   * outputClassSuccess: additional class for successful output lines\u000a *   * outputClassFailure: additional class for unsuccessful output lines\u000a *\u000a * @param options modal options\u000a * @param promise promise to monitor\u000a * @returns {*|jQuery} the modal object\u000a */\u000afunction showProgressModal(options, promise) {\u000a    var title = options.title || gettext("Progress");\u000a    var message = options.message || "";\u000a    var buttonText = options.button || gettext("Close");\u000a    var max = options.max || undefined;\u000a    var close = options.close || false;\u000a    var output = options.output || false;\u000a\u000a    var dialogClass = options.dialogClass || "";\u000a    var barClassSuccess = options.barClassSuccess || "";\u000a    var barClassFailure = options.barClassFailure || "bar-danger";\u000a    var outputClassSuccess = options.outputClassSuccess || "";\u000a    var outputClassFailure = options.outputClassFailure || "text-error";\u000a\u000a    var modalHeader = $("<h3>" + title + "</h3>");\u000a    var paragraph = $("<p>" + message + "</p>");\u000a\u000a    var progress = $('<div class="progress progress-text-centered"></div>');\u000a    var progressBar = $('<div class="bar"></div>').addClass(barClassSuccess);\u000a    var progressTextBack = $('<span class="progress-text-back"></span>');\u000a    var progressTextFront = $('<span class="progress-text-front"></span>').width(\u000a        progress.width()\u000a    );\u000a\u000a    if (max === undefined) {\u000a        progress.addClass("progress-striped active");\u000a        progressBar.width("100%");\u000a    }\u000a\u000a    progressBar.append(progressTextFront);\u000a    progress.append(progressTextBack).append(progressBar);\u000a\u000a    var button = $('<button class="btn">' + buttonText + "</button>")\u000a        .prop("disabled", true)\u000a        .attr("data-dismiss", "modal")\u000a        .attr("aria-hidden", "true");\u000a\u000a    var modalBody = $("<div></div>")\u000a        .addClass("modal-body")\u000a        .append(paragraph)\u000a        .append(progress);\u000a\u000a    var pre;\u000a    if (output) {\u000a        pre = $(\u000a            "<pre class='pre-scrollable pre-output' style='height: 70px; font-size: 0.8em'></pre>"\u000a        );\u000a        modalBody.append(pre);\u000a    }\u000a\u000a    var modal = $("<div></div>")\u000a        .addClass("modal hide fade")\u000a        .addClass(dialogClass)\u000a        .append($("<div></div>").addClass("modal-header").append(modalHeader))\u000a        .append(modalBody)\u000a        .append($("<div></div>").addClass("modal-footer").append(button));\u000a    modal.modal({keyboard: false, backdrop: "static", show: true});\u000a\u000a    var counter = 0;\u000a    promise\u000a        .progress(function () {\u000a            var short, long, success;\u000a            if (arguments.length === 2) {\u000a                short = long = arguments[0];\u000a                success = arguments[1];\u000a            } else if (arguments.length === 3) {\u000a                short = arguments[0];\u000a                long = arguments[1];\u000a                success = arguments[2];\u000a            } else {\u000a                throw Error(\u000a                    "Invalid parameters for showProgressModal, expected either (text, success) or (short, long, success)"\u000a                );\u000a            }\u000a\u000a            var value;\u000a\u000a            if (max === undefined || max <= 0) {\u000a                value = 100;\u000a            } else {\u000a                counter++;\u000a                value = Math.max(Math.min((counter * 100) / max, 100), 0);\u000a            }\u000a\u000a            // update progress bar\u000a            progressBar.width(String(value) + "%");\u000a            progressTextFront.text(short);\u000a            progressTextBack.text(short);\u000a            progressTextFront.width(progress.width());\u000a\u000a            // if not successful, apply failure class\u000a            if (!success && !progressBar.hasClass(barClassFailure)) {\u000a                progressBar.removeClass(barClassSuccess).addClass(barClassFailure);\u000a            }\u000a\u000a            if (output && pre) {\u000a                if (success) {\u000a                    pre.append(\u000a                        $("<span class='" + outputClassSuccess + "'>" + long + "</span>")\u000a                    );\u000a                } else {\u000a                    pre.append(\u000a                        $("<span class='" + outputClassFailure + "'>" + long + "</span>")\u000a                    );\u000a                }\u000a                pre.scrollTop(pre[0].scrollHeight - pre.height());\u000a            }\u000a        })\u000a        .done(function () {\u000a            button.prop("disabled", false);\u000a            if (close) {\u000a                modal.modal("hide");\u000a            }\u000a        })\u000a        .fail(function () {\u000a            button.prop("disabled", false);\u000a        });\u000a\u000a    return modal;\u000a}\u000a\u000afunction showReloadOverlay() {\u000a    $("#reloadui_overlay").show();\u000a}\u000a\u000afunction wrapPromiseWithAlways(p) {\u000a    var deferred = $.Deferred();\u000a    p.always(function () {\u000a        deferred.resolve.apply(deferred, arguments);\u000a    });\u000a    return deferred.promise();\u000a}\u000a\u000afunction commentableLinesToArray(lines) {\u000a    return splitTextToArray(lines, "\u005cn", true, function (item) {\u000a        return !_.startsWith(item, "#");\u000a    });\u000a}\u000a\u000afunction splitTextToArray(text, sep, stripEmpty, filter) {\u000a    return _.filter(\u000a        _.map(text.split(sep), function (item) {\u000a            return item ? item.trim() : "";\u000a        }),\u000a        function (item) {\u000a            return (stripEmpty ? item : true) && (filter ? filter(item) : true);\u000a        }\u000a    );\u000a}\u000a\u000a/**\u000a * Returns true if comparing data and oldData yields changes, false otherwise.\u000a *\u000a * E.g.\u000a *\u000a *   hasDataChanged(\u000a *     {foo: "bar", fnord: {one: "1", two: "2", three: "three", key: "value"}},\u000a *     {foo: "bar", fnord: {one: "1", two: "2", three: "3", four: "4"}}\u000a *   )\u000a *\u000a * will return\u000a *\u000a *   true\u000a *\u000a * and\u000a *\u000a *   hasDataChanged(\u000a *     {foo: "bar", fnord: {one: "1", two: "2", three: "3"}},\u000a *     {foo: "bar", fnord: {one: "1", two: "2", three: "3"}}\u000a *   )\u000a *\u000a * will return\u000a *\u000a *   false\u000a *\u000a * Note that this will assume data and oldData to be structurally identical (same keys)\u000a * and is optimized to check for value changes, not key updates.\u000a */\u000afunction hasDataChanged(data, oldData) {\u000a    // noinspection EqualityComparisonWithCoercionJS\u000a    if (data == oldData && data == undefined) {\u000a        return false;\u000a    }\u000a\u000a    if (_.isPlainObject(data) && _.isPlainObject(oldData)) {\u000a        return _.any(_.keys(data), function (key) {\u000a            return hasDataChanged(data[key], oldData[key]);\u000a        });\u000a    } else {\u000a        return !_.isEqual(data, oldData);\u000a    }\u000a}\u000a\u000a/**\u000a * Compare provided data and oldData plain objects and only return those\u000a * substructures of data that actually changed.\u000a *\u000a * E.g.\u000a *\u000a *   getOnlyChangedData(\u000a *     {foo: "bar", fnord: {one: "1", two: "2", three: "three"}},\u000a *     {foo: "bar", fnord: {one: "1", two: "2", three: "3"}}\u000a *   )\u000a *\u000a * will return\u000a *\u000a *   {fnord: {three: "three"}}\u000a *\u000a * and\u000a *\u000a *   getOnlyChangedData(\u000a *     {foo: "bar", fnord: {one: "1", two: "2", three: "3"}},\u000a *     {foo: "bar", fnord: {one: "1", two: "2", three: "3"}}\u000a *   )\u000a *\u000a * will return\u000a *\u000a *   {}\u000a *\u000a * Note that this will assume data and oldData to be structurally identical (same keys)\u000a * and is optimized to check for value changes, not key updates.\u000a */\u000afunction getOnlyChangedData(data, oldData) {\u000a    // noinspection EqualityComparisonWithCoercionJS\u000a    if (data == undefined) {\u000a        return {};\u000a    }\u000a\u000a    // noinspection EqualityComparisonWithCoercionJS\u000a    if (oldData == undefined) {\u000a        return data;\u000a    }\u000a\u000a    var f = function (root, oldRoot) {\u000a        if (!_.isPlainObject(root)) {\u000a            return root;\u000a        }\u000a\u000a        var retval = {};\u000a        _.forOwn(root, function (value, key) {\u000a            var oldValue = undefined;\u000a            // noinspection EqualityComparisonWithCoercionJS\u000a            if (oldRoot != undefined && oldRoot.hasOwnProperty(key)) {\u000a                oldValue = oldRoot[key];\u000a            }\u000a            if (_.isPlainObject(value)) {\u000a                // noinspection EqualityComparisonWithCoercionJS\u000a                if (oldValue == undefined) {\u000a                    retval[key] = value;\u000a                } else if (hasDataChanged(value, oldValue)) {\u000a                    retval[key] = f(value, oldValue);\u000a                }\u000a            } else {\u000a                // noinspection EqualityComparisonWithCoercionJS\u000a                if (\u000a                    !(value == oldValue && value == undefined) &&\u000a                    !_.isEqual(value, oldValue)\u000a                ) {\u000a                    retval[key] = value;\u000a                }\u000a            }\u000a        });\u000a        return retval;\u000a    };\u000a\u000a    return f(data, oldData);\u000a}\u000a\u000afunction setOnViewModels(allViewModels, key, value) {\u000a    setOnViewModelsIf(allViewModels, key, value, undefined);\u000a}\u000a\u000afunction setOnViewModelsIf(allViewModels, key, value, condition) {\u000a    if (!allViewModels) return;\u000a    _.each(allViewModels, function (viewModel) {\u000a        setOnViewModelIf(viewModel, key, value, condition);\u000a    });\u000a}\u000a\u000afunction setOnViewModel(viewModel, key, value) {\u000a    setOnViewModelIf(viewModel, key, value, undefined);\u000a}\u000a\u000afunction setOnViewModelIf(viewModel, key, value, condition) {\u000a    if (condition === undefined || !_.isFunction(condition)) {\u000a        condition = function () {\u000a            return true;\u000a        };\u000a    }\u000a\u000a    try {\u000a        if (!condition(viewModel)) {\u000a            return;\u000a        }\u000a\u000a        viewModel[key] = value;\u000a    } catch (exc) {\u000a        if (typeof Sentry !== "undefined") {\u000a            Sentry.captureException(exc);\u000a        }\u000a        log.error(\u000a            "Error while setting",\u000a            key,\u000a            "to",\u000a            value,\u000a            "on view model",\u000a            viewModel.constructor.name,\u000a            ":",\u000a            exc.stack || exc\u000a        );\u000a    }\u000a}\u000a\u000afunction callViewModels(allViewModels, method, callback) {\u000a    callViewModelsIf(allViewModels, method, undefined, callback);\u000a}\u000a\u000afunction callViewModelsIf(allViewModels, method, condition, callback) {\u000a    if (!allViewModels) return;\u000a\u000a    _.each(allViewModels, function (viewModel) {\u000a        try {\u000a            callViewModelIf(viewModel, method, condition, callback);\u000a        } catch (exc) {\u000a            if (typeof Sentry !== "undefined") {\u000a                Sentry.captureException(exc);\u000a            }\u000a            log.error(\u000a                "Error calling",\u000a                method,\u000a                "on view model",\u000a                viewModel.constructor.name,\u000a                ":",\u000a                exc.stack || exc\u000a            );\u000a        }\u000a    });\u000a}\u000a\u000afunction callViewModel(viewModel, method, callback, raiseErrors) {\u000a    callViewModelIf(viewModel, method, undefined, callback, raiseErrors);\u000a}\u000a\u000afunction callViewModelIf(viewModel, method, condition, callback, raiseErrors) {\u000a    raiseErrors = raiseErrors === true || false;\u000a\u000a    if (condition === undefined || !_.isFunction(condition)) {\u000a        condition = function () {\u000a            return true;\u000a        };\u000a    }\u000a\u000a    if (!_.isFunction(viewModel[method]) || !condition(viewModel, method)) return;\u000a\u000a    var parameters = undefined;\u000a    if (!_.isFunction(callback)) {\u000a        // if callback is not a function that means we are supposed to directly\u000a        // call the view model method instead of providing it to the callback\u000a        // - let's figure out how\u000a\u000a        if (callback === undefined) {\u000a            // directly call view model method with no parameters\u000a            parameters = undefined;\u000a            log.trace("Calling method", method, "on view model");\u000a        } else if (_.isArray(callback)) {\u000a            // directly call view model method with these parameters\u000a            parameters = callback;\u000a            log.trace(\u000a                "Calling method",\u000a                method,\u000a                "on view model with specified parameters",\u000a                parameters\u000a            );\u000a        } else {\u000a            // ok, this doesn't make sense, callback is neither undefined nor\u000a            // an array, we'll return without doing anything\u000a            return;\u000a        }\u000a\u000a        // we reset this here so we now further down that we want to call\u000a        // the method directly\u000a        callback = undefined;\u000a    } else {\u000a        log.trace(\u000a            "Providing method",\u000a            method,\u000a            "on view model to specified callback",\u000a            callback\u000a        );\u000a    }\u000a\u000a    try {\u000a        if (callback === undefined) {\u000a            if (parameters !== undefined) {\u000a                // call the method with the provided parameters\u000a                viewModel[method].apply(viewModel, parameters);\u000a            } else {\u000a                // call the method without parameters\u000a                viewModel[method]();\u000a            }\u000a        } else {\u000a            // provide the method to the callback\u000a            callback(viewModel[method], viewModel);\u000a        }\u000a    } catch (exc) {\u000a        if (typeof Sentry !== "undefined") {\u000a            Sentry.captureException(exc);\u000a        }\u000a        if (raiseErrors) {\u000a            throw exc;\u000a        } else {\u000a            log.error(\u000a                "Error calling",\u000a                method,\u000a                "on view model",\u000a                viewModel.constructor.name,\u000a                ":",\u000a                exc.stack || exc\u000a            );\u000a        }\u000a    }\u000a}\u000a\u000avar sizeObservable = function (observable) {\u000a    return ko.computed({\u000a        read: function () {\u000a            return formatSize(observable());\u000a        },\u000a        write: function (value) {\u000a            var result = bytesFromSize(value);\u000a            if (result !== undefined) {\u000a                observable(result);\u000a            }\u000a        }\u000a    });\u000a};\u000a\u000avar getQueryParameterByName = function (name, url) {\u000a    // from http://stackoverflow.com/a/901144/2028598\u000a    if (!url) {\u000a        url = window.location.href;\u000a    }\u000a    name = name.replace(/[\u005c[\u005c]]/g, "\u005c\u005c$&");\u000a    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),\u000a        results = regex.exec(url);\u000a    if (!results) return null;\u000a    if (!results[2]) return "";\u000a    return decodeURIComponent(results[2].replace(/\u005c+/g, " "));\u000a};\u000a\u000a/**\u000a * Escapes unprintable ASCII characters in the provided string.\u000a *\u000a * E.g. turns a null byte in the string into "\u005cx00".\u000a *\u000a * Characters 0 to 31 excluding 9, 10 and 13 will be escaped, as will\u000a * 127, 128 to 159 and 255. That should leave printable characters and unicode\u000a * alone.\u000a *\u000a * Originally based on\u000a * https://gist.github.com/mathiasbynens/1243213#gistcomment-53590\u000a *\u000a * @param str The string to escape\u000a * @returns {string}\u000a */\u000avar escapeUnprintableCharacters = function (str) {\u000a    var result = "";\u000a    var index = 0;\u000a    var charCode;\u000a\u000a    while (!isNaN((charCode = str.charCodeAt(index)))) {\u000a        if (\u000a            (charCode < 32 && charCode !== 9 && charCode !== 10 && charCode !== 13) ||\u000a            charCode === 127 ||\u000a            (charCode >= 128 && charCode <= 159) ||\u000a            charCode === 255\u000a        ) {\u000a            // special hex chars\u000a            result += "\u005c\u005cx" + (charCode > 15 ? "" : "0") + charCode.toString(16);\u000a        } else {\u000a            // anything else\u000a            result += str[index];\u000a        }\u000a\u000a        index++;\u000a    }\u000a    return result;\u000a};\u000a\u000avar copyToClipboard = function (text) {\u000a    var temp = $("<textarea>");\u000a    $("body").append(temp);\u000a    temp.val(text).select();\u000a    document.execCommand("copy");\u000a    temp.remove();\u000a};\u000a\u000avar determineWebcamStreamType = function (streamUrl) {\u000a    if (streamUrl) {\u000a        var lastDotPosition = streamUrl.lastIndexOf(".");\u000a        var firstQuotationSignPosition = streamUrl.indexOf("?");\u000a        if (\u000a            lastDotPosition != -1 &&\u000a            firstQuotationSignPosition != -1 &&\u000a            lastDotPosition >= firstQuotationSignPosition\u000a        ) {\u000a            throw "Malformed URL. Cannot determine stream type.";\u000a        }\u000a\u000a        // If we have found a dot, try to extract the extension.\u000a        if (lastDotPosition > -1) {\u000a            if (firstQuotationSignPosition > -1) {\u000a                var extension = streamUrl.slice(\u000a                    lastDotPosition + 1,\u000a                    firstQuotationSignPosition - 1\u000a                );\u000a            } else {\u000a                var extension = streamUrl.slice(lastDotPosition + 1);\u000a            }\u000a            if (extension.toLowerCase() == "m3u8") {\u000a                return "hls";\u000a            }\u000a        }\u000a        // By default, 'mjpg' is the stream type.\u000a        return "mjpg";\u000a    } else {\u000a        throw "Empty streamUrl. Cannot determine stream type.";\u000a    }\u000a};\u000a\u000avar saveToLocalStorage = function (key, data) {\u000a    if (!Modernizr.localstorage) return;\u000a    localStorage[key] = JSON.stringify(data);\u000a};\u000a\u000avar loadFromLocalStorage = function (key) {\u000a    if (!Modernizr.localstorage) return {};\u000a\u000a    var currentString = localStorage[key];\u000a    var current;\u000a    if (currentString === undefined) {\u000a        current = {};\u000a    } else {\u000a        try {\u000a            current = JSON.parse(currentString);\u000a        } catch (ex) {\u000a            current = {};\u000a        }\u000a    }\u000a    return current;\u000a};\u000a\u000avar deepMerge = function (target, source) {\u000a    /**\u000a     * Implements an object deep merge, which contrary to _.merge doesn't try to\u000a     * merge arrays.\u000a     */\u000a    if (!_.isObject(target)) {\u000a        return target;\u000a    }\u000a\u000a    _.forOwn(source, function (value, key) {\u000a        if (\u000a            target.hasOwnProperty(key) &&\u000a            _.isPlainObject(target[key]) &&\u000a            _.isPlainObject(value)\u000a        ) {\u000a            target[key] = deepMerge(target[key], value);\u000a        } else {\u000a            target[key] = value;\u000a        }\u000a    });\u000a\u000a    return target;\u000a};\u000a\u000a;\u000a
p0
.